@model IEnumerable<Product>
@{
	ViewData["Title"] = "Product Manage";
}
<h3>@ViewData["Title"]</h3>

<a class="btn btn-outline-primary" href="/Admin/Product/CreateProduct">Create Product</a> |
<a class="btn btn-outline-primary" href="/Admin/Home/Index">Back to Home</a>
<hr />
<div class="container">
	<table class="table" id="ProductTable">
		<thead>
			<tr>

				<th>
					Product Name
				</th>
				<th>
					Title
				</th>
				<th>
					Created Date
				</th>
			
				<th>
					Weight
				</th>
				<th>
					Category
				</th>
				<th>
					Brand
				</th>
				<th>
					Price
				</th>
				<th>
					Action
				</th>
			</tr>
		</thead>
	</table>
</div>
@section Scripts{
	<script>
		var dataTable;
		$(document).ready(function() {
			loadDataTable();
		});
		function loadDataTable() {
			dataTable = $("#ProductTable").DataTable({
				"ajax": {
					"url": "/Admin/Product/GetAllProduct"
				},
				"columns": [
					{ "data": "productName", "width": "10%" },
					{ "data": "title", "width": "10%" },
					{ "data": "createdDate", "width": "10%" },
					{ "data": "weight", "width": "10%" },
					{ "data": "brand_Category.category.categoryName", "width": "10%" },
					{ "data": "brand_Category.brand.brandName", "width": "10%" },
					{ "data": "price", "width": "10%" },
					{
						"data": "productId",
						"render": function(data) {
							return `<div class="w-75 btn-group" role="group">

														</a>
														<a onClick=Delete('/Admin/Product/DeleteProduct/${data}')  class="btn btn-outline-primary" />Delete
														</a>
														<a href="/Admin/Product/UpdateProduct?id=${data}"  class="btn btn-outline-primary" />Update
														</a>
														</div>`
						},
						"width": "10%"
					}
				]
			});
		}
		function Delete(url) {
			Swal.fire({
				title: 'Are you sure?',
				text: "You won't be able to revert this!",
				icon: 'warning',
				showCancelButton: true,
				confirmButtonColor: '#3085d6',
				cancelButtonColor: '#d33',
				confirmButtonText: 'Yes, delete it!'
			}).then((result) => {
				if (result.isConfirmed) {
					$.ajax({
						url: url,
						type: 'DELETE',
						success: function(data) {
							if (data.success) {
								dataTable.ajax.reload();
								Swal.fire({
									position: 'top-end',
									icon: 'success',
									title: 'Product has been deleted',
									showConfirmButton: false,
									timer: 1500
								})
							} else {
								Swal.fire({
									icon: 'error',
									title: 'Oops...',
									text: 'Check out if stock still available, you can not delete product.',
								})
							}
						}
					});
				}
			})
		}
	</script>
}
